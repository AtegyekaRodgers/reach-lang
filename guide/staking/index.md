[{"bookPath":"guide","title":"Staking and Unstaking Tokens","titleId":"guide-staking","hasOtp":true,"hasPageHeader":true},"<p>\n  <i id=\"p_0\" class=\"pid\"></i>Reach makes DApp development safer, faster, and more secure.\n  This guide offers a real example of the advantages of using Reach.<a href=\"#p_0\" class=\"pid\">0</a>\n</p>\n<p>\n  <i id=\"p_1\" class=\"pid\"></i>Here's an example provided by Austin Wilshire at <a href=\"https://twitter.com/xbacked\">xBacked</a>.\n  Follow Austin on Twitter <a href=\"https://twitter.com/awoldes\">@awoldes</a>.<a href=\"#p_1\" class=\"pid\">1</a>\n</p>\n<p>\n  <i id=\"p_2\" class=\"pid\"></i>Imagine you want to stake a token and at a later date unstake it with all the rewards.\n  Let's look at a snippet from the perspective of a Deployer.<a href=\"#p_2\" class=\"pid\">2</a>\n</p>\n<p><i id=\"p_3\" class=\"pid\"></i>As the deployer, you want to set the reward rate, <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Token\" title=\"rsh: Token\"><span style=\"color: #24292E\">Token</span></a></span> ID of the token being staked, the <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Token\" title=\"rsh: Token\"><span style=\"color: #24292E\">Token</span></a></span> ID of the rewarded token, and the initial supply of the reward token.<a href=\"#p_3\" class=\"pid\">3</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"// Initiate the Deployer's local state\nDeployer.only(() => {\n    // this = address doing transaction\n    const deployerAddr = this;\n    // Declassify data and store in constants\n    const stakeToken = declassify(interact.setStakeToken());\n    const rewardRate = declassify(interact.setRewardRate());\n    const rewardToken = declassify(interact.setRewardToken());\n    const initialSupply = declassify(interact.setInitialSupply());\n});\n\n// Publish this information to global state\nDeployer.publish(\n    deployerAddr,\n    stakeToken,\n    rewardRate,\n    rewardToken,\n    initialSupply,\n);\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: #6A737D\">// Initiate the Deployer's local state</span></li><li value=\"2\"><span style=\"color: #24292E\">Deployer.</span><a href=\"/rsh/step/#rsh_only\" title=\"rsh: only\"><span style=\"color: #6F42C1\">only</span></a><span style=\"color: #24292E\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: #D73A49\">=&gt;</span></a><span style=\"color: #24292E\"> {</span></li><li value=\"3\"><span style=\"color: #24292E\">    </span><span style=\"color: #6A737D\">// this = address doing transaction</span></li><li value=\"4\"><span style=\"color: #24292E\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: #D73A49\">const</span></a><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">deployerAddr</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: #005CC5\">this</span></a><span style=\"color: #24292E\">;</span></li><li value=\"5\"><span style=\"color: #24292E\">    </span><span style=\"color: #6A737D\">// Declassify data and store in constants</span></li><li value=\"6\"><span style=\"color: #24292E\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: #D73A49\">const</span></a><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">stakeToken</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><a href=\"/rsh/local/#rsh_declassify\" title=\"rsh: declassify\"><span style=\"color: #6F42C1\">declassify</span></a><span style=\"color: #24292E\">(interact.</span><span style=\"color: #6F42C1\">setStakeToken</span><span style=\"color: #24292E\">());</span></li><li value=\"7\"><span style=\"color: #24292E\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: #D73A49\">const</span></a><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">rewardRate</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><a href=\"/rsh/local/#rsh_declassify\" title=\"rsh: declassify\"><span style=\"color: #6F42C1\">declassify</span></a><span style=\"color: #24292E\">(interact.</span><span style=\"color: #6F42C1\">setRewardRate</span><span style=\"color: #24292E\">());</span></li><li value=\"8\"><span style=\"color: #24292E\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: #D73A49\">const</span></a><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">rewardToken</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><a href=\"/rsh/local/#rsh_declassify\" title=\"rsh: declassify\"><span style=\"color: #6F42C1\">declassify</span></a><span style=\"color: #24292E\">(interact.</span><span style=\"color: #6F42C1\">setRewardToken</span><span style=\"color: #24292E\">());</span></li><li value=\"9\"><span style=\"color: #24292E\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: #D73A49\">const</span></a><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">initialSupply</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><a href=\"/rsh/local/#rsh_declassify\" title=\"rsh: declassify\"><span style=\"color: #6F42C1\">declassify</span></a><span style=\"color: #24292E\">(interact.</span><span style=\"color: #6F42C1\">setInitialSupply</span><span style=\"color: #24292E\">());</span></li><li value=\"10\"><span style=\"color: #24292E\">});</span></li><li value=\"11\"></li><li value=\"12\"><span style=\"color: #6A737D\">// Publish this information to global state</span></li><li value=\"13\"><span style=\"color: #24292E\">Deployer.</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: #6F42C1\">publish</span></a><span style=\"color: #24292E\">(</span></li><li value=\"14\"><span style=\"color: #24292E\">    deployerAddr,</span></li><li value=\"15\"><span style=\"color: #24292E\">    stakeToken,</span></li><li value=\"16\"><span style=\"color: #24292E\">    rewardRate,</span></li><li value=\"17\"><span style=\"color: #24292E\">    rewardToken,</span></li><li value=\"18\"><span style=\"color: #24292E\">    initialSupply,</span></li><li value=\"19\"><span style=\"color: #24292E\">);</span></li></ol></pre>\n<p>\n  <i id=\"p_4\" class=\"pid\"></i>The configurable contract is deployed. The next step is to enable users to interact with it.\n  In Reach, the solution is to add an API call so that when the user calls the function, they will pay <span class=\"snip\"><span style=\"color: #24292E\">tokenAmt</span></span> of the <span class=\"snip\"><span style=\"color: #24292E\">stakeToken</span></span> in the Deployer set.<a href=\"#p_4\" class=\"pid\">4</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\".api(User.stakeTokens,\n  (tokenAmt) => {\n      // validation that a user must stake more than 1 token\n      // they will receive the message on the frontend if it fails\n      assume(tokenAmt >= 1, 'Must stake at least 1 token');\n  },\n  (tokenAmt) => {\n      //looks unintuitive, but this means the user will\n      // pay 0 network tokens, and pay tokenAmt in rewardTokens\n      return [0, [tokenAmt, stakeToken]]\n  },\n  (tokenAmt, apiReturn) => {\n      require(tokenAmt >= 1, 'Must stake at least 1 token');\n\n      userLocalState[this] = {\n          stake: tokenAmt,\n          pendingRewards: 0,\n      }\n      // return to the API caller\n      apiReturn(true)\n  }\n)\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: #24292E\">.</span><span style=\"color: #6F42C1\">api</span><span style=\"color: #24292E\">(User.stakeTokens,</span></li><li value=\"2\"><span style=\"color: #24292E\">  (</span><span style=\"color: #E36209\">tokenAmt</span><span style=\"color: #24292E\">) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: #D73A49\">=&gt;</span></a><span style=\"color: #24292E\"> {</span></li><li value=\"3\"><span style=\"color: #24292E\">      </span><span style=\"color: #6A737D\">// validation that a user must stake more than 1 token</span></li><li value=\"4\"><span style=\"color: #24292E\">      </span><span style=\"color: #6A737D\">// they will receive the message on the frontend if it fails</span></li><li value=\"5\"><span style=\"color: #24292E\">      </span><a href=\"/rsh/local/#rsh_assume\" title=\"rsh: assume\"><span style=\"color: #6F42C1\">assume</span></a><span style=\"color: #24292E\">(tokenAmt </span><a href=\"/rsh/compute/#rsh_%3E=\" title=\"rsh: >=\"><span style=\"color: #D73A49\">&gt;=</span></a><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">'Must stake at least 1 token'</span><span style=\"color: #24292E\">);</span></li><li value=\"6\"><span style=\"color: #24292E\">  },</span></li><li value=\"7\"><span style=\"color: #24292E\">  (</span><span style=\"color: #E36209\">tokenAmt</span><span style=\"color: #24292E\">) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: #D73A49\">=&gt;</span></a><span style=\"color: #24292E\"> {</span></li><li value=\"8\"><span style=\"color: #24292E\">      </span><span style=\"color: #6A737D\">//looks unintuitive, but this means the user will</span></li><li value=\"9\"><span style=\"color: #24292E\">      </span><span style=\"color: #6A737D\">// pay 0 network tokens, and pay tokenAmt in rewardTokens</span></li><li value=\"10\"><span style=\"color: #24292E\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: #D73A49\">return</span></a><span style=\"color: #24292E\"> [</span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">, [tokenAmt, stakeToken]]</span></li><li value=\"11\"><span style=\"color: #24292E\">  },</span></li><li value=\"12\"><span style=\"color: #24292E\">  (</span><span style=\"color: #E36209\">tokenAmt</span><span style=\"color: #24292E\">, </span><span style=\"color: #E36209\">apiReturn</span><span style=\"color: #24292E\">) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: #D73A49\">=&gt;</span></a><span style=\"color: #24292E\"> {</span></li><li value=\"13\"><span style=\"color: #24292E\">      </span><a href=\"/rsh/consensus/#rsh_require\" title=\"rsh: require\"><span style=\"color: #005CC5\">require</span></a><span style=\"color: #24292E\">(tokenAmt </span><a href=\"/rsh/compute/#rsh_%3E=\" title=\"rsh: >=\"><span style=\"color: #D73A49\">&gt;=</span></a><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">1</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">'Must stake at least 1 token'</span><span style=\"color: #24292E\">);</span></li><li value=\"14\"></li><li value=\"15\"><span style=\"color: #24292E\">      userLocalState[</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: #005CC5\">this</span></a><span style=\"color: #24292E\">] </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> {</span></li><li value=\"16\"><span style=\"color: #24292E\">          stake: tokenAmt,</span></li><li value=\"17\"><span style=\"color: #24292E\">          pendingRewards: </span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">,</span></li><li value=\"18\"><span style=\"color: #24292E\">      }</span></li><li value=\"19\"><span style=\"color: #24292E\">      </span><span style=\"color: #6A737D\">// return to the API caller</span></li><li value=\"20\"><span style=\"color: #24292E\">      </span><span style=\"color: #6F42C1\">apiReturn</span><span style=\"color: #24292E\">(</span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: #005CC5\">true</span></a><span style=\"color: #24292E\">)</span></li><li value=\"21\"><span style=\"color: #24292E\">  }</span></li><li value=\"22\"><span style=\"color: #24292E\">)</span></li></ol></pre>\n<h2 id=\"unstaking\" class=\"refHeader\">Unstaking<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#unstaking\"><span class=\"icon icon-link\"></span></a></h2>\n<p><i id=\"p_5\" class=\"pid\"></i>Unstaking is similar in structure.<a href=\"#p_5\" class=\"pid\">5</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\".api(User.unstakeAndClaim,\n  () => {\n      // No rewards left in the contract? Sry!\n      assume(balance(rewardToken) > 0, 'No rewards left')\n  },\n  () => {\n      // transfer nothing to the contract\n      return [0, [0, stakeToken]]\n  },\n  (apiReturn) => {\n      require(balance(rewardToken) > 0, 'No rewards left')\n      const userState = userLocalState[this];\n      // pay acrued rewards\n      transfer([[userState.pendingrewards, rewardToken]]).to(this);\n\n      userLocalState[this] = {\n          stake: 0,\n          pendingRewards: 0,\n      }\n      // return to the API caller\n      apiReturn(true)\n      // update global state\n      return [\n          rewardSupply - userState.pendingRewards\n      ]\n  }\n)\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: #24292E\">.</span><span style=\"color: #6F42C1\">api</span><span style=\"color: #24292E\">(User.unstakeAndClaim,</span></li><li value=\"2\"><span style=\"color: #24292E\">  () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: #D73A49\">=&gt;</span></a><span style=\"color: #24292E\"> {</span></li><li value=\"3\"><span style=\"color: #24292E\">      </span><span style=\"color: #6A737D\">// No rewards left in the contract? Sry!</span></li><li value=\"4\"><span style=\"color: #24292E\">      </span><a href=\"/rsh/local/#rsh_assume\" title=\"rsh: assume\"><span style=\"color: #6F42C1\">assume</span></a><span style=\"color: #24292E\">(</span><a href=\"/rsh/compute/#rsh_balance\" title=\"rsh: balance\"><span style=\"color: #6F42C1\">balance</span></a><span style=\"color: #24292E\">(rewardToken) </span><a href=\"/rsh/compute/#rsh_%3E\" title=\"rsh: >\"><span style=\"color: #D73A49\">&gt;</span></a><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">'No rewards left'</span><span style=\"color: #24292E\">)</span></li><li value=\"5\"><span style=\"color: #24292E\">  },</span></li><li value=\"6\"><span style=\"color: #24292E\">  () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: #D73A49\">=&gt;</span></a><span style=\"color: #24292E\"> {</span></li><li value=\"7\"><span style=\"color: #24292E\">      </span><span style=\"color: #6A737D\">// transfer nothing to the contract</span></li><li value=\"8\"><span style=\"color: #24292E\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: #D73A49\">return</span></a><span style=\"color: #24292E\"> [</span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">, [</span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">, stakeToken]]</span></li><li value=\"9\"><span style=\"color: #24292E\">  },</span></li><li value=\"10\"><span style=\"color: #24292E\">  (</span><span style=\"color: #E36209\">apiReturn</span><span style=\"color: #24292E\">) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: #D73A49\">=&gt;</span></a><span style=\"color: #24292E\"> {</span></li><li value=\"11\"><span style=\"color: #24292E\">      </span><a href=\"/rsh/consensus/#rsh_require\" title=\"rsh: require\"><span style=\"color: #005CC5\">require</span></a><span style=\"color: #24292E\">(</span><a href=\"/rsh/compute/#rsh_balance\" title=\"rsh: balance\"><span style=\"color: #6F42C1\">balance</span></a><span style=\"color: #24292E\">(rewardToken) </span><a href=\"/rsh/compute/#rsh_%3E\" title=\"rsh: >\"><span style=\"color: #D73A49\">&gt;</span></a><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">, </span><span style=\"color: #032F62\">'No rewards left'</span><span style=\"color: #24292E\">)</span></li><li value=\"12\"><span style=\"color: #24292E\">      </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: #D73A49\">const</span></a><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">userState</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> userLocalState[</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: #005CC5\">this</span></a><span style=\"color: #24292E\">];</span></li><li value=\"13\"><span style=\"color: #24292E\">      </span><span style=\"color: #6A737D\">// pay acrued rewards</span></li><li value=\"14\"><span style=\"color: #24292E\">      </span><a href=\"/rsh/consensus/#rsh_transfer\" title=\"rsh: transfer\"><span style=\"color: #6F42C1\">transfer</span></a><span style=\"color: #24292E\">([[userState.pendingrewards, rewardToken]]).</span><span style=\"color: #6F42C1\">to</span><span style=\"color: #24292E\">(</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: #005CC5\">this</span></a><span style=\"color: #24292E\">);</span></li><li value=\"15\"></li><li value=\"16\"><span style=\"color: #24292E\">      userLocalState[</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: #005CC5\">this</span></a><span style=\"color: #24292E\">] </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> {</span></li><li value=\"17\"><span style=\"color: #24292E\">          stake: </span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">,</span></li><li value=\"18\"><span style=\"color: #24292E\">          pendingRewards: </span><span style=\"color: #005CC5\">0</span><span style=\"color: #24292E\">,</span></li><li value=\"19\"><span style=\"color: #24292E\">      }</span></li><li value=\"20\"><span style=\"color: #24292E\">      </span><span style=\"color: #6A737D\">// return to the API caller</span></li><li value=\"21\"><span style=\"color: #24292E\">      </span><span style=\"color: #6F42C1\">apiReturn</span><span style=\"color: #24292E\">(</span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: #005CC5\">true</span></a><span style=\"color: #24292E\">)</span></li><li value=\"22\"><span style=\"color: #24292E\">      </span><span style=\"color: #6A737D\">// update global state</span></li><li value=\"23\"><span style=\"color: #24292E\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: #D73A49\">return</span></a><span style=\"color: #24292E\"> [</span></li><li value=\"24\"><span style=\"color: #24292E\">          rewardSupply </span><a href=\"/rsh/compute/#rsh_-\" title=\"rsh: -\"><span style=\"color: #D73A49\">-</span></a><span style=\"color: #24292E\"> userState.pendingRewards</span></li><li value=\"25\"><span style=\"color: #24292E\">      ]</span></li><li value=\"26\"><span style=\"color: #24292E\">  }</span></li><li value=\"27\"><span style=\"color: #24292E\">)</span></li></ol></pre>\n<h2 id=\"connect-to-view\" class=\"refHeader\">Connect to View<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#connect-to-view\"><span class=\"icon icon-link\"></span></a></h2>\n<p><i id=\"p_6\" class=\"pid\"></i>Now for the cool part: Use your contract to hook to your website. To accomplish this, we connect to the <a href=\"/frontend/#ref-frontends-js-ctc\">contract</a>, deine the User's <a href=\"/rsh/appinit/#ref-programs-appinit-api\">API</a> calls and a <a href=\"/rsh/appinit/#ref-programs-appinit-view\">View</a>.<a href=\"#p_6\" class=\"pid\">6</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"// connect to the contract\nconst ctcInfo = account.contract(backend, CONTRACT_INFO);\n// defines all User api calls (stakeTokens, unstaketokens)\nconst userApi = contract.a.User;\n// defines the View\nconst userView = contract.v.read;\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: #6A737D\">// connect to the contract</span></li><li value=\"2\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: #D73A49\">const</span></a><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">ctcInfo</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> account.</span><span style=\"color: #6F42C1\">contract</span><span style=\"color: #24292E\">(backend, </span><span style=\"color: #005CC5\">CONTRACT_INFO</span><span style=\"color: #24292E\">);</span></li><li value=\"3\"><span style=\"color: #6A737D\">// defines all User api calls (stakeTokens, unstaketokens)</span></li><li value=\"4\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: #D73A49\">const</span></a><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">userApi</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> contract.a.User;</span></li><li value=\"5\"><span style=\"color: #6A737D\">// defines the View</span></li><li value=\"6\"><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: #D73A49\">const</span></a><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">userView</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> contract.v.read;</span></li></ol></pre>\n<p><i id=\"p_7\" class=\"pid\"></i>Next, we get the users state by reading the <a href=\"/rsh/compute/#ref-programs-types\">address</a>.<a href=\"#p_7\" class=\"pid\">7</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"useEffect(async() => {\n    // get users local state from application\n    const userState = await userView.read(account.addr);\n    setUserState(userState);\n}, []);\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: #6F42C1\">useEffect</span><span style=\"color: #24292E\">(</span><span style=\"color: #D73A49\">async</span><span style=\"color: #24292E\">() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: #D73A49\">=&gt;</span></a><span style=\"color: #24292E\"> {</span></li><li value=\"2\"><span style=\"color: #24292E\">    </span><span style=\"color: #6A737D\">// get users local state from application</span></li><li value=\"3\"><span style=\"color: #24292E\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: #D73A49\">const</span></a><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">userState</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">await</span><span style=\"color: #24292E\"> userView.</span><span style=\"color: #6F42C1\">read</span><span style=\"color: #24292E\">(account.addr);</span></li><li value=\"4\"><span style=\"color: #24292E\">    </span><span style=\"color: #6F42C1\">setUserState</span><span style=\"color: #24292E\">(userState);</span></li><li value=\"5\"><span style=\"color: #24292E\">}, []);</span></li></ol></pre>\n<p><i id=\"p_8\" class=\"pid\"></i>Then, create an event listener that connects to the wallet.<a href=\"#p_8\" class=\"pid\">8</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"<div>\n  {/* On button clicks, these functions will trigger the wallet */}\n  <button onClick={async () => await userApi.stakeTokens(amt)}>\n    Stake Tokens\n  </button>\n\n  <button onClick ={async () => await userApi.unstakeTokens(amt)}>\n    Unstake Tokens + {userState.pendingRewards} rewards\n  </button>\n</div>\" href=\"#\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"/rsh/compute/#rsh_%3C\" title=\"rsh: <\"><span style=\"color: #24292E\">&lt;</span></a><a href=\"/rsh/compute/#rsh_div\" title=\"rsh: div\"><span style=\"color: #22863A\">div</span></a><a href=\"/rsh/compute/#rsh_%3E\" title=\"rsh: >\"><span style=\"color: #24292E\">&gt;</span></a></li><li value=\"2\"><span style=\"color: #24292E\">  {</span><span style=\"color: #6A737D\">/* On button clicks, these functions will trigger the wallet */</span><span style=\"color: #24292E\">}</span></li><li value=\"3\"><span style=\"color: #24292E\">  &lt;</span><span style=\"color: #22863A\">button</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">onClick</span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\">{</span><span style=\"color: #D73A49\">async</span><span style=\"color: #24292E\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: #D73A49\">=&gt;</span></a><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">await</span><span style=\"color: #24292E\"> userApi.</span><span style=\"color: #6F42C1\">stakeTokens</span><span style=\"color: #24292E\">(amt)}&gt;</span></li><li value=\"4\"><span style=\"color: #24292E\">    Stake Tokens</span></li><li value=\"5\"><span style=\"color: #24292E\">  &lt;/</span><span style=\"color: #22863A\">button</span><a href=\"/rsh/compute/#rsh_%3E\" title=\"rsh: >\"><span style=\"color: #24292E\">&gt;</span></a></li><li value=\"6\"></li><li value=\"7\"><span style=\"color: #24292E\">  &lt;</span><span style=\"color: #22863A\">button</span><span style=\"color: #24292E\"> </span><span style=\"color: #005CC5\">onClick</span><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">=</span><span style=\"color: #24292E\">{</span><span style=\"color: #D73A49\">async</span><span style=\"color: #24292E\"> () </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: #D73A49\">=&gt;</span></a><span style=\"color: #24292E\"> </span><span style=\"color: #D73A49\">await</span><span style=\"color: #24292E\"> userApi.</span><span style=\"color: #6F42C1\">unstakeTokens</span><span style=\"color: #24292E\">(amt)}&gt;</span></li><li value=\"8\"><span style=\"color: #24292E\">    Unstake Tokens + {userState.pendingRewards} rewards</span></li><li value=\"9\"><span style=\"color: #24292E\">  &lt;/</span><span style=\"color: #22863A\">button</span><a href=\"/rsh/compute/#rsh_%3E\" title=\"rsh: >\"><span style=\"color: #24292E\">&gt;</span></a></li><li value=\"10\"><span style=\"color: #24292E\">&lt;/</span><a href=\"/rsh/compute/#rsh_div\" title=\"rsh: div\"><span style=\"color: #22863A\">div</span></a><a href=\"/rsh/compute/#rsh_%3E\" title=\"rsh: >\"><span style=\"color: #24292E\">&gt;</span></a></li></ol></pre>\n<h2 id=\"conclusion\" class=\"refHeader\">Conclusion<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#conclusion\"><span class=\"icon icon-link\"></span></a></h2>\n<p>\n  <i id=\"p_9\" class=\"pid\"></i>This demonstrates the essential (but not quite complete) elements of implementing a contract in Reach.\n  There's no magic involved, but it definitely feels like there is when you're building a Reach application.\n  As a developer, you don't need to think about forming transaction groups, SDK calls, or opting in.\n  Reach handles <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Token\" title=\"rsh: Token\"><span style=\"color: #24292E\">Token</span></a></span> IDs and Application opt-ins, on networks that require opt-ins. You focus on the business logic of your DApp and plug into the consensus network of your choice.<a href=\"#p_9\" class=\"pid\">9</a>\n</p>","<ul><li class=\"dynamic\">\n    <a href=\"#guide-staking\">Staking and Unstaking Tokens</a>\n    <ul class=\"dynamic\">\n      <li class=\"dynamic\"><a href=\"#unstaking\">Unstaking</a></li>\n      <li class=\"dynamic\"><a href=\"#connect-to-view\">Connect to View</a></li>\n      <li class=\"dynamic\"><a href=\"#conclusion\">Conclusion</a></li>\n    </ul>\n  </li></ul>"]